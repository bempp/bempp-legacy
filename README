Introduction
============

BEM++ is a novel open-source HPC boundary-element library. Its development
started in October 2011.

1.0 is the first official version of the library. It was released on XX October 2012.

The library has been tested under Scientific Linux 6.1, Ubuntu 12.04,
OpenSUSE 12.1 and Mac OS 10.7.

Obtaining the code
==================

The code is available from https://github.com/bempp/bempp.

To download the code, you need to have the Git version control system
(http://git-scm.com) installed. To get the (stable) version 1.0 of the library,
execute ``git clone -b release_1.0 git://github.com/bempp/bempp.git`` from the
command line in an empty directory. To download the current development version,
execute ``git clone git://github.com/bempp/bempp.git`` instead.

Bugfixes to the stable version of BEM++ will be committed to the release_1.0
branch. You can obtain the latest bugfixes by executing ``git pull`` in the
directory to which you downloaded the code.

Installation
============

To build the library you need a recent version of Python 2 (2.6 or newer). The
Python interface has mostly been tested with Enthought Python, but other
distributions will also work (however, see below for important remarks about
BLAS and LAPACK). Note that Python visualization depends on Mayavi being
available. The remaining dependencies of the library (currently CMake,
Armadillo, Boost, Dune, Swig, Intel TBB and Trilinos) are automatically
downloaded and compiled by the installer. You need at least 2.5 GB of free space
to build the library and all its dependencies; however, most of this space can
be recovered after a successful installation.

To build the library, do the following:

1. Copy the file ``bempp_setup.cfg.template`` into another file
   (e.g. ``bempp_setup.cfg``) and adapt the configuration variables.

   You may wish to change at least the following options:

   - Location of BLAS and Lapack.  You can either use MKL or manually specify
     BLAS and Lapack libraries.  If you intend to use the Python wrappers of
     BEM++, we recommend linking BEM++ with the same BLAS and Lapack as the
     NumPy package.  If your NumPy is linked with MKL (this is the case in
     Enthought Python, in particular), you can tell the BEM++ installer to
     detect the location of the MKL libraries automatically.

     **Warning**: Many Linux distributions come with versions of BLAS and LAPACK
     built with the gfortran compiler.  Unfortunately, with its default
     compilation settings, gfortran produces non-threadsafe versions of some
     LAPACK routines (more information can be found at
     http://icl.cs.utk.edu/lapack-forum/viewtopic.php?f=2&t=1930). Linked
     against such versions of LAPACK and used in multithreaded mode, BEM++ will
     produce incorrect (random) results. Therefore you are strongly advised to
     either use LAPACK from Intel MKL, which is free from this bug, or to
     compile LAPACK yourself, including ``-fmax-stack-var-size=66560`` in the
     list of gfortran compilation options.

     **Take-home message:** If you do not feel comfortable with compiling LAPACK
     and NumPy on your own, we strongly recommend to use Enthought Python to
     install BEM++ and to uncomment the lines ``enable_mkl=yes`` and
     ``source=like_numpy`` in the ``MKL`` section of the configuration file.

   - Enable AHMED for H-Matrix support. You need to uncomment
     ``enable_ahmed=yes`` and set the option ``file_name`` in the AHMED section
     to the location of the AHMED installer file. You can download the file from
     ``http://bebendorf.ins.uni-bonn.de/AHMED.html``.

2. Run the command ::

   python bempp_setup.py -b bempp_setup.cfg

   This bootstrap phase downloads the BEM++ build system (CMake) and
   all BEM++ dependencies (currently Armadillo, Boost, Dune, Swig, TBB
   and Trilinos), creates the necessary directories and compiles and
   installs CMake into the BEM++ installation directory. Note that you
   need to have write access to the installation directory.

3. Run the command ::

   python bempp_setup.py -c bempp_config.cfg

   This extracts all BEM++ dependencies, patches their sources where
   necessary and generates a config file with automatically detected options.

4. Run the command ::

   python bempp_setup.py -i all bempp_config.cfg

   This builds all the dependencies and installs them, and subsequently
   proceeds to building and installing BEM++ itself.

   The library will be installed into ``<prefix>/bempp/lib`` and the python
   module at ``<prefix>/bempp/python``, where ``<prefix>`` is the directory
   specified in the configuration file.  Note that the generation of the Python
   module takes rather a long time. Therefore, the installer may seem to hang
   for a few minutes without doing anything.

5. If you have Doxygen installed, you can generate documentation of the C++ API
   of BEM++ by going into ``<build_dir>`` and typing ``make doc``. The
   documentation is generated in the ``<build_dir>/doc/html`` directory. You are
   advised to use a recent version of Doxygen (e.g. 1.8.2), since older versions
   do not always parse C++ templates properly.

6. If you have Sphinx installed, you can generate documentation of the Python
   API of BEM++ by going into ``<build_dir>`` and typing ``make
   python_doc``. The documentation is generated in the
   ``<build_dir>/python/doc/html`` directory.

Usage
=====

As mentioned above, the ``examples`` and ``python/examples`` directories contain
a few examples demonstrating the usage of the C++ and Python interfaces to the
library. In particular, the ``tutorial_dirichlet.cpp`` and
``tutorial_dirichlet.py`` are described in detail on the BEM++ website
(``http://www.bempp.org/tutorial_dirichlet.html``). After a successful BEM++
installation, the compiled version of C++ examples are available in
``<build_dir>/examples``.

To build your own programs using BEM++, you need to add the
``<prefix>/bempp/include`` and ``<prefix>/bempp/include/bempp`` paths to the
include path of your compiler, and link to the ``bempp`` and ``teuchos``
libraries installed in ``<prefix>/bempp/lib`` (the latter is a component of
Trilinos). On Linux, it is also advisable to include ``<prefix>/bempp/lib`` in
the runtime path of your executable. On a Mac, you should add
``<prefix>/bempp/lib`` to the ``DYLD_LIBRARY_PATH`` environment variable before
running your program.

A schematic GCC invocation for compiling and linking a program ``my_program``
with BEM++ on Linux looks as follows::

g++ -I <prefix>/bempp/include -I <prefix>/bempp/include/bempp my_program.cpp
-o my_program -L <prefix>/bempp/lib -lbempp -lteuchos
-Wl,-rpath,<prefix>/bempp/lib

On a Mac, you would omit ``-Wl,-rpath,<prefix>/bempp/lib``, but type ``export
DYLD_LIBRARY_PATH=${DYLD_LIBRARY_PATH}:<prefix>/bempp/lib`` before running
``my_program``.

The file ``doc/misc/CMakeLists.txt.example`` contains an example ``CMakeLists``
file that can be used to build a program employing BEM++ with CMake.

To use the Python interface to BEM++, simply put ::

import sys
sys.path.append("<prefix>/bempp/python")
import bempp.lib as blib

at the beginning of your Python script (replacing ``<prefix>`` with the path to
the BEM++ installation directory).

Contact
=======

If you run into problems with installation or usage of BEM++, please let us know
by opening an issue at https://github.com/bempp/bempp/issues.

The BEM++ Team




